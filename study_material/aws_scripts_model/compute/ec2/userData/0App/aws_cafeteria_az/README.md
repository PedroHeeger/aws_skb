Esse arquivo de user data precisou ser entendido com mais detalhes para o funcionamento correto da aplicação web. As primeiras ações executadas por esse arquivo foi atualização do pacote e instalação dos softwares utilizados. Em seguida, os servidores web (**Apache HTTP (Httpd)**) e de banco de dados (**MariaDB**) foram iniciados e habilitados. O arquivo raiz `index.html` do sevidor **Apache HTTP (Httpd)**, que ficava armazenado em `/var/www/html/`, foi alterado modificando o texto para `Hello From Your Web Server!`. Assim, ao acessar o IP ou DNS público da instância do EC2 sem adicionar nenhum path, a requisição bateria neste arquivo que era o arquivo raiz deste servidor web. Isso era só para mostrar que o servidor estava operado, a aplicação web funcionava no diretório `/cafe` dentro do diretório do Apache. Continuando no arquivo de user data, o diretório `/var/www` foi procurado e com o comando `chmod 2775` as permissões desse diretório e dos arquivos dentro dele foram alteradas. Dessa forma o proprietário e o grupo tinham permissões de leitura, escrita e execução, e outros usuários tinham permissões de leitura e execução. Além disso, o bit SetGID foi definido como `2` para que novos arquivos herdassem o grupo do diretório pai. Em seguida os arquivos em `/var/www` foram procurados e as permissões foram alteradas com `chmod 0664`, o que significava que o proprietário e o grupo tinham permissões de leitura e escrita, e outros usuários tinham permissões de leitura.

O próximo comando executado adicionava uma informação através de um comando **PHP** a um arquivo que era criado com nome `phpinfo.php` dentro do diretório do servidor web **Apache HTTP (Httpd)**. O usuário padrão da instância **Amazon Linux**, `ec2-user`, foi adicionado ao grupo `Apache` sem remover os demais. Em seguida, o proprietário e grupo de todos os arquivos dentro de `/var/www` foram alterados para `ec2-user:apache`. Mais uma vez o `chmod` foi executado, basicamente igual ao primeiro `chmod`, alterando as permissões do diretório `/var/www` para que o proprietário e o grupo tivessem permissões de leitura, escrita e execução, e outros usuários tivessem permissões de leitura e execução. O bit SetGID foi definido para garantir que novos arquivos criados dentro deste diretório herdassem o grupo `apache`.

Após isso, os três seguintes arquivos foram baixados: `setup-v2.tar.gz`, `db-v2.tar.gz` e `cafe-v2.tar.gz`. Os dois primeiros foram descompactados no diretório corrente, enquanto o terceiro, que era a aplicação web, foi descompactado dentro do diretório do servidor web **Apache HTTP (Httpd)**, `/var/www/html`. A descompactação do terceiro arquivo resultou no diretório `cafe` com arquivos e pastas que configuravam a aplicação web. Como o diretório `cafe` ficava dentro de `/var/www/html`, que é o diretório raiz do Apache, era preciso adicionar o `/cafe` no path da URL junto com IP ou DNS público da instância para acessar o arquivo `index.html` dentro da pasta `cafe`, que era onde a aplicação web da cafeteria rodava. A descompactação do segundo arquivo resultou na pasta `db` com arquivos e sub-pastas que configuravam o banco de dados dentro da instância do EC2. Já a descompactação do primeiro arquivo resultou na pasta `setup` com apenas dois arquivos: `set-app-parameters.sh` e `createSsmAccessIAMRole.sh`. Alguns desses arquivos foram extremamente importantes para o entendimento do funcionamento da aplicação web.

Com término da descompactação, a pasta `setup` foi acessada e o arquivo `set-app-parameters.sh` foi executado. Este arquivo capturava a zona de disponibilidade em que a instância do EC2, onde esse arquivo era executado, estava, acessando seus metadados. Com a AZ capturada, a região era extraída e exportada para a configuração do **AWS CLI** instalado nessa instância. O DNS público da instância também era capturado através dos seus metadados. Por fim, sete parâmetros era configurados no *Parameter Store* do **AWS SSM**, incluíndo o nome do banco de dados, um usuário de acesso ao banco e sua senha de acesso, e a URL do banco de dados, que neste caso utilizou o DNS público da instância do EC2 capturado anteriormente. A URL foi o DNS da instância, porque era onde o banco de dados operava. A imagem 58 exibe os setes parâmetros elaborados no *Parameter Store* do **AWS SSM**.

Após isso, a pasta `db` foi acessada e o arquivo `set-root-password.sh` foi executado. Este apenas solicitava que o arquivo `set-root-password.sql`, dentro do sub-diretório `sql` dessa pasta, fosse executado enviando o output para o arquivo de nome `set-root-password.log`, que era o arquivo de log do **SQL**. O arquivo `set-root-password.sql` alterou a senha do usuário root do banco de dados **MariaDB** para a senha definida em um dos parâmetros criados no *Parameter Store*. O parâmetro do *Parameter Store* que definia o usuário utilizado pela aplicação web já era o usuário root, exatamente igual ao arquivo `set-root-password.sql`. Em seguida, o arquivo `create-db.sh`, também na pasta `db`, foi executado e era similar o anterior, solicitava que o arquivo `create-db.sql` na sub-pasta `sql` fosse executado enviando o output para o arquivo de log `create-db.log`. O arquivo `create-db.sql` basicamente construía o banco de dados `cafe_db` no **MariaDB** da instância do EC2 com as tabelas, sendo algumas com dados já inseridos. Esse nome de banco de dados `cafe_db` foi o mesmo configurado em um dos parâmetros do *Parameter Store*.

A pasta `cafe`, apesar de não ter sido acessada, teve uma enorme importância. Essa pasta continha todos os arquivos da aplicação web que era executada no servidor Apache instalado na instância do EC2. A aplicação era construída em **PHP** e utilizava o **AWS SDK** dessa linguagem para interagir com recursos da **AWS**. Dessa forma, a aplicação interagia com o recurso *Parameter Store* do **AWS SSM** através do arquivo `getAppParameters.php`. Este arquivo buscava os valores dos setes parâmetros definidos no *Parameter Store*,  pelo arquivo `set-app-parameters.sh` da pasta `setup`, para utilizá-los na aplicação. Esses dois arquivos mostravam que a instância do **Amazon EC2** se relacionava com *Parameter Store* do **AWS SSM**. Contudo, na **AWS**, para que um serviço se relacione com outro é necessário permissões, caso contrário, não há relacionamento. Na pasta `setup` existia o arquivo `createSsmAccessIAMRole.sh`, ele não era executado, mas indicava que era preciso criar uma role com uma política de permissão e que a entidade na política de confiança fosse o EC2, vincular a role a um perfil de instância e passar esse perfil para a instância em construção. Assim, a instância estaria liberada a interagir com o SSM. Se isso não fosse realizado, a aplicação web não era construída corretamente e não funcionava por completo, pois não teria os valores dos parâmetros necessários, inclusive as informações para conexão com o banco de dados. A aplicação apenas exibia o título Cafe quando acessada no navegador.